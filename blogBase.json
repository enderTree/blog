{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "ender'Blog", "subTitle": "\u95ed\u5173", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P1": {"htmlDir": "docs/post/test.html", "labels": ["sql"], "postTitle": "test", "postUrl": "post/test.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/1", "commentNum": 1, "wordCount": 518, "description": "```sql\n\nSELECT\n    *\nFROM\n(\n\n    SELECT\n        tag,\n        doc_cnt,\n        (doc_cnt/SUM(doc_cnt) OVER())*100\n    FROM\n    (\n        SELECT \n            tag,\n            SUM(doc_cnt) AS doc_cnt\n        FROM\n            dwd_crawler_host_classification_di a\n        LEFT ANTI JOIN \n            tmp_gumu_data_0624_2 b\n            ON a.host = b.host\n        WHERE\n            ymd = '2025-06-23'\n            AND tag_type = 'topic'\n        GROUP BY \n            tag\n    )\n)\nWHERE \n    tag = 'Advertising_&_Marketing'\n;\n```\u3002", "top": 0, "createdAt": 1750819859, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P2": {"htmlDir": "docs/post/chuang-kou-han-shu-de-yi-xie-shi-yong.html", "labels": ["sql"], "postTitle": "\u7a97\u53e3\u51fd\u6570\u7684\u4e00\u4e9b\u4f7f\u7528", "postUrl": "post/chuang-kou-han-shu-de-yi-xie-shi-yong.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/2", "commentNum": 0, "wordCount": 452, "description": "#### 1. \u53d6\u6700\u8fd1\u4e00\u4e2a\u4e0d\u4e3a\u7a7a\u7684\u503c\u586b\u5145\n```sql\nWITH mian_data AS (\n    SELECT\n        c0,\n        c1,\n        IF(c1 = '\u5904\u7f6e', NULL, c2) AS c2\n    FROM\n        VALUES\n         (1,'\u5904\u7f6e','1')\n        ,(2,'\u5904\u7f6e','2')\n        ,(3,'\u5904\u7f6e','3')\n        ,(4,'\u5904\u7f6e','4')\n        ,(5,'\u63d0\u4ea4','A')\n        ,(6,'\u5904\u7f6e','5')\n        ,(7,'\u63d0\u4ea4','b')\n    AS a(c0,c1,c2)\n)\nSELECT \n    *,\n    FIRST_VALUE(c2, True) over(order by c0 ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)\nFROM \n    mian_data \n```\u3002", "top": 0, "createdAt": 1750822716, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P3": {"htmlDir": "docs/post/jie-jue-Join-shu-ju-qing-xie.html", "labels": ["sql"], "postTitle": "\u89e3\u51b3Join\u6570\u636e\u503e\u659c", "postUrl": "post/jie-jue-Join-shu-ju-qing-xie.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/3", "commentNum": 0, "wordCount": 1836, "description": "\u4f18\u5316\u524d\uff1a\n```sql\nSELECT \n        /*+ mapjoin(dd),skewjoin(a(url))*/\n        a.* except(url_tag, join_key),\n        CASE \n            WHEN cc.url IS NOT NULL THEN 'black_url'\n            WHEN dd.url IS NOT NULL THEN 'black_url'\n            ELSE ''\n        END AS url_tag\n    FROM\n    (\n        select \n            *,\n            1 AS join_key\n        from \n            dwd_crawler_urls_step1_di a \n        where \n            ymd = '${P_DATE}'\n            AND url_tag != 'black_url'\n    ) as\n    LEFT JOIN \n        black_urls2 cc  \n        ON replace(a.host, 'www.', '') = replace(cc.url, 'www.', '')\n\tLEFT JOIN \n        black_urls1 dd  \n        ON INSTR(a.url, dd.url) > 0\n```\n\u4f18\u5316\u540e\n```sql\nSELECT \n        /*+ mapjoin(dd),skewjoin(a(url))*/\n        a.* except(url_tag, join_key),\n        CASE \n            WHEN cc.url IS NOT NULL THEN 'black_url'\n            WHEN dd.url IS NOT NULL THEN 'black_url'\n            ELSE ''\n        END AS url_tag\n    FROM\n    (\n        select \n            *,\n            1 AS join_key\n        from \n            dwd_crawler_urls_step1_di a \n        where \n            ymd = '${P_DATE}'\n            AND url_tag != 'black_url'\n    ) a\n    LEFT JOIN \n        black_urls1 dd  \n        ON INSTR(a.url, dd.url) > 0\n    LEFT JOIN \n        black_urls2 cc  \n        ON replace(a.host, 'www.', '') = replace(cc.url, 'www.', '')\n```\n\u4f18\u5316\u524d\u6267\u884c\u65f6\u95f4\n\n<img width='991' alt='Image' src='https://github.com/user-attachments/assets/3d62cdfd-b1e0-4579-adc9-a8bc19ac64ff' />\n\n<img width='872' alt='Image' src='https://github.com/user-attachments/assets/46033d2f-9fbe-4400-b6c6-489f97ee7f00' />\n\n\u4f18\u5316\u540e\u6267\u884c\u65f6\u95f4\n\n<img width='978' alt='Image' src='https://github.com/user-attachments/assets/74de5fc3-08ff-4ed6-8c94-9b0d31c18799' />\n\n<img width='944' alt='Image' src='https://github.com/user-attachments/assets/b2f397da-420d-484b-9655-3dda6ee57046' />\n\u3002", "top": 0, "createdAt": 1750822743, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P4": {"htmlDir": "docs/post/quan-ju-pai-xu-you-hua.html", "labels": ["sql"], "postTitle": "\u5168\u5c40\u6392\u5e8f\u4f18\u5316", "postUrl": "post/quan-ju-pai-xu-you-hua.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/4", "commentNum": 0, "wordCount": 1240, "description": "```sql\n\nCREATE TABLE talkie_dialogue.tmp_nana_data_1028_555 AS \nWITH hash_bucket AS (\n    SELECT  \n        *,\n        ROW_NUMBER() OVER (PARTITION BY bucket_no ORDER BY user_msg_log_ucnt_30d ASC ) AS bucket_rel_index,\n        COUNT(1) OVER (PARTITION BY bucket_no ) AS bucket_size\n    FROM    \n    (\n        SELECT  \n            *,\n            ABS(HASH(cid)) % 100000 AS bucket_no \n        FROM    \n            talkie_dialogue.tmp_nana_data_1028_4            \n    ) \n),\nbucket_base AS \n(\n    SELECT\n        bucket_no\n        SUM(bucket_size) OVER (ORDER BY bucket_no ASC) - bucket_size AS bucket_base\n    FROM\n    (\n        SELECT \n            bucket_no,\n            bucket_size\n        FROM\n            hash_bucket\n    )\n)\nSELECT\n    /*+ MAPJOIN(t2) */ t1.*,\n    t2.bucket_base + bucket_rel_index AS id_index\nFROM\n    hash_bucket t1 \nJOIN \n    bucket_base t2 \n    ON t1.bucket_no = t2.bucket_no\n    AND t1.mid_rank = t2.mid_rank\n    AND t1.country_rank = t2.country_rank\n    AND t1.setting_type = t2.setting_type\n;\n```\n\n\u6838\u5fc3\u4ee3\u7801\u5982\u4e0a\uff0c\u4e3b\u8981\u601d\u8def\u5148\u505a\u5206\u6876\u8fdb\u884c\u5206\u5e03\u5f0f\u5c40\u90e8\u6392\u5e8f\u3001\u518d\u57fa\u4e8e\u6876\u5927\u5c0f\u5f97\u5230\u5168\u5c40\u7d22\u5f15\n\n1. \u7b2c\u4e00\u6b65\u5148\u5bf9id\u505ahash\u5206\u6876\uff0c\u7136\u540e\u8ba1\u7b97\u6bcf\u4e2a\u6876\u7684\u5927\u5c0f\uff0c\u6876\u6570\u91cf\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8ba1\u7b97\u7684id\u6570\u91cf\u6765\u8bc4\u4f30\uff0c\u8fd9\u91cc\u5206100000\u4e2a\u6876\uff0c\u7136\u540e\u8ba1\u7b97\u51fa\u6bcf\u4e2aid\u5728\u6876\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6ebucket_rel_index\uff0c\u540c\u65f6\u8ba1\u7b97\u51fa\u6876\u5927\u5c0fbucket_size\uff1b\n2. \u7b2c\u4e8c\u6b65\u6839\u636e\u6876\u5927\u5c0f\u8ba1\u7b97\u6bcf\u4e2a\u6876\u7684\u57fa\u5740\uff1b\n3. \u7b2c\u4e09\u6b65\u5c06\u6876\u57fa\u5740+id\u5728\u6876\u5185\u7684\u76f8\u5bf9\u5730\u5740\u5f97\u5230\u5168\u5c40\u552f\u4e00\u7684\u7edd\u5bf9\u5730\u5740id_index\uff1b\n\n\u3002", "top": 0, "createdAt": 1750822762, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "documentation": "#0075ca", "duplicate": "#cfd3d7", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "question": "#d876e3", "sql": "#a3bf9d", "wontfix": "#ffffff"}, "displayTitle": "ender'Blog", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://enderTree.github.io/blog", "prevUrl": "disabled", "nextUrl": "disabled"}