{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "ender'Blog", "subTitle": "\u95ed\u5173", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P1": {"htmlDir": "docs/post/test.html", "labels": ["sql"], "postTitle": "test", "postUrl": "post/test.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/1", "commentNum": 1, "wordCount": 518, "description": "```sql\n\nSELECT\n    *\nFROM\n(\n\n    SELECT\n        tag,\n        doc_cnt,\n        (doc_cnt/SUM(doc_cnt) OVER())*100\n    FROM\n    (\n        SELECT \n            tag,\n            SUM(doc_cnt) AS doc_cnt\n        FROM\n            dwd_crawler_host_classification_di a\n        LEFT ANTI JOIN \n            tmp_gumu_data_0624_2 b\n            ON a.host = b.host\n        WHERE\n            ymd = '2025-06-23'\n            AND tag_type = 'topic'\n        GROUP BY \n            tag\n    )\n)\nWHERE \n    tag = 'Advertising_&_Marketing'\n;\n```\u3002", "top": 0, "createdAt": 1750819859, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P2": {"htmlDir": "docs/post/chuang-kou-han-shu-de-yi-xie-shi-yong.html", "labels": ["sql"], "postTitle": "\u7a97\u53e3\u51fd\u6570\u7684\u4e00\u4e9b\u4f7f\u7528", "postUrl": "post/chuang-kou-han-shu-de-yi-xie-shi-yong.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/2", "commentNum": 0, "wordCount": 452, "description": "#### 1. \u53d6\u6700\u8fd1\u4e00\u4e2a\u4e0d\u4e3a\u7a7a\u7684\u503c\u586b\u5145\n```sql\nWITH mian_data AS (\n    SELECT\n        c0,\n        c1,\n        IF(c1 = '\u5904\u7f6e', NULL, c2) AS c2\n    FROM\n        VALUES\n         (1,'\u5904\u7f6e','1')\n        ,(2,'\u5904\u7f6e','2')\n        ,(3,'\u5904\u7f6e','3')\n        ,(4,'\u5904\u7f6e','4')\n        ,(5,'\u63d0\u4ea4','A')\n        ,(6,'\u5904\u7f6e','5')\n        ,(7,'\u63d0\u4ea4','b')\n    AS a(c0,c1,c2)\n)\nSELECT \n    *,\n    FIRST_VALUE(c2, True) over(order by c0 ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)\nFROM \n    mian_data \n```\u3002", "top": 0, "createdAt": 1750822716, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P3": {"htmlDir": "docs/post/jie-jue-Join-shu-ju-qing-xie.html", "labels": ["sql"], "postTitle": "\u89e3\u51b3Join\u6570\u636e\u503e\u659c", "postUrl": "post/jie-jue-Join-shu-ju-qing-xie.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/3", "commentNum": 0, "wordCount": 1836, "description": "\u4f18\u5316\u524d\uff1a\n```sql\nSELECT \n        /*+ mapjoin(dd),skewjoin(a(url))*/\n        a.* except(url_tag, join_key),\n        CASE \n            WHEN cc.url IS NOT NULL THEN 'black_url'\n            WHEN dd.url IS NOT NULL THEN 'black_url'\n            ELSE ''\n        END AS url_tag\n    FROM\n    (\n        select \n            *,\n            1 AS join_key\n        from \n            dwd_crawler_urls_step1_di a \n        where \n            ymd = '${P_DATE}'\n            AND url_tag != 'black_url'\n    ) as\n    LEFT JOIN \n        black_urls2 cc  \n        ON replace(a.host, 'www.', '') = replace(cc.url, 'www.', '')\n\tLEFT JOIN \n        black_urls1 dd  \n        ON INSTR(a.url, dd.url) > 0\n```\n\u4f18\u5316\u540e\n```sql\nSELECT \n        /*+ mapjoin(dd),skewjoin(a(url))*/\n        a.* except(url_tag, join_key),\n        CASE \n            WHEN cc.url IS NOT NULL THEN 'black_url'\n            WHEN dd.url IS NOT NULL THEN 'black_url'\n            ELSE ''\n        END AS url_tag\n    FROM\n    (\n        select \n            *,\n            1 AS join_key\n        from \n            dwd_crawler_urls_step1_di a \n        where \n            ymd = '${P_DATE}'\n            AND url_tag != 'black_url'\n    ) a\n    LEFT JOIN \n        black_urls1 dd  \n        ON INSTR(a.url, dd.url) > 0\n    LEFT JOIN \n        black_urls2 cc  \n        ON replace(a.host, 'www.', '') = replace(cc.url, 'www.', '')\n```\n\u4f18\u5316\u524d\u6267\u884c\u65f6\u95f4\n\n<img width='991' alt='Image' src='https://github.com/user-attachments/assets/3d62cdfd-b1e0-4579-adc9-a8bc19ac64ff' />\n\n<img width='872' alt='Image' src='https://github.com/user-attachments/assets/46033d2f-9fbe-4400-b6c6-489f97ee7f00' />\n\n\u4f18\u5316\u540e\u6267\u884c\u65f6\u95f4\n\n<img width='978' alt='Image' src='https://github.com/user-attachments/assets/74de5fc3-08ff-4ed6-8c94-9b0d31c18799' />\n\n<img width='944' alt='Image' src='https://github.com/user-attachments/assets/b2f397da-420d-484b-9655-3dda6ee57046' />\n\u3002", "top": 0, "createdAt": 1750822743, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P4": {"htmlDir": "docs/post/quan-ju-pai-xu-you-hua.html", "labels": ["sql"], "postTitle": "\u5168\u5c40\u6392\u5e8f\u4f18\u5316", "postUrl": "post/quan-ju-pai-xu-you-hua.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/4", "commentNum": 0, "wordCount": 1240, "description": "```sql\n\nCREATE TABLE talkie_dialogue.tmp_nana_data_1028_555 AS \nWITH hash_bucket AS (\n    SELECT  \n        *,\n        ROW_NUMBER() OVER (PARTITION BY bucket_no ORDER BY user_msg_log_ucnt_30d ASC ) AS bucket_rel_index,\n        COUNT(1) OVER (PARTITION BY bucket_no ) AS bucket_size\n    FROM    \n    (\n        SELECT  \n            *,\n            ABS(HASH(cid)) % 100000 AS bucket_no \n        FROM    \n            talkie_dialogue.tmp_nana_data_1028_4            \n    ) \n),\nbucket_base AS \n(\n    SELECT\n        bucket_no\n        SUM(bucket_size) OVER (ORDER BY bucket_no ASC) - bucket_size AS bucket_base\n    FROM\n    (\n        SELECT \n            bucket_no,\n            bucket_size\n        FROM\n            hash_bucket\n    )\n)\nSELECT\n    /*+ MAPJOIN(t2) */ t1.*,\n    t2.bucket_base + bucket_rel_index AS id_index\nFROM\n    hash_bucket t1 \nJOIN \n    bucket_base t2 \n    ON t1.bucket_no = t2.bucket_no\n    AND t1.mid_rank = t2.mid_rank\n    AND t1.country_rank = t2.country_rank\n    AND t1.setting_type = t2.setting_type\n;\n```\n\n\u6838\u5fc3\u4ee3\u7801\u5982\u4e0a\uff0c\u4e3b\u8981\u601d\u8def\u5148\u505a\u5206\u6876\u8fdb\u884c\u5206\u5e03\u5f0f\u5c40\u90e8\u6392\u5e8f\u3001\u518d\u57fa\u4e8e\u6876\u5927\u5c0f\u5f97\u5230\u5168\u5c40\u7d22\u5f15\n\n1. \u7b2c\u4e00\u6b65\u5148\u5bf9id\u505ahash\u5206\u6876\uff0c\u7136\u540e\u8ba1\u7b97\u6bcf\u4e2a\u6876\u7684\u5927\u5c0f\uff0c\u6876\u6570\u91cf\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8ba1\u7b97\u7684id\u6570\u91cf\u6765\u8bc4\u4f30\uff0c\u8fd9\u91cc\u5206100000\u4e2a\u6876\uff0c\u7136\u540e\u8ba1\u7b97\u51fa\u6bcf\u4e2aid\u5728\u6876\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6ebucket_rel_index\uff0c\u540c\u65f6\u8ba1\u7b97\u51fa\u6876\u5927\u5c0fbucket_size\uff1b\n2. \u7b2c\u4e8c\u6b65\u6839\u636e\u6876\u5927\u5c0f\u8ba1\u7b97\u6bcf\u4e2a\u6876\u7684\u57fa\u5740\uff1b\n3. \u7b2c\u4e09\u6b65\u5c06\u6876\u57fa\u5740+id\u5728\u6876\u5185\u7684\u76f8\u5bf9\u5730\u5740\u5f97\u5230\u5168\u5c40\u552f\u4e00\u7684\u7edd\u5bf9\u5730\u5740id_index\uff1b\n\n\u3002", "top": 0, "createdAt": 1750822762, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P5": {"htmlDir": "docs/post/biao-ming-ming-gui-fan.html", "labels": ["\u6570\u4ed3"], "postTitle": "\u8868\u547d\u540d\u89c4\u8303", "postUrl": "post/biao-ming-ming-gui-fan.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/5", "commentNum": 0, "wordCount": 341, "description": "\n### 1. \u6570\u4ed3\u5206\u5c42\n\u6309 ods -> dwd -> dwm -> dws ->ads \u6765\u505a\n- dwd\uff1a\u4e8b\u5b9e\u7ea7\u522b\u7684\u660e\u7ec6\uff0c\u6216\u8005did uid\u7ea7\u7684\u6570\u636e\u3002", "top": 0, "createdAt": 1750836617, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P6": {"htmlDir": "docs/post/MaxCompute-wai-biao-shi-yong.html", "labels": ["sql"], "postTitle": "MaxCompute\u5916\u8868\u4f7f\u7528", "postUrl": "post/MaxCompute-wai-biao-shi-yong.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/6", "commentNum": 0, "wordCount": 2570, "description": "### 1. \u5efa\u8868\n1. json\u683c\u5f0f\n\n```sql\nCREATE EXTERNAL TABLE IF NOT EXISTS dialogue.dwd_ext_xingye_log_chatml_data(\n    `data` STRING\n) \nPARTITIONED BY (\n    data_type STRING,\n    ymd STRING) \nROW FORMAT SERDE 'org.apache.hive.hcatalog.data.JsonSerDe' \nSTORED AS INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat' \nOUTPUTFORMAT 'org.apache.hadoop.mapred.TextOutputFormat' \nLOCATION 'oss://data-dlc/minimax-dialogue/data/chatml/';\n```\n\n2. parquet\u683c\u5f0f\n   ```sql\n   CREATE EXTERNAL TABLE dwd_crawler_html_out_di\n   (\n      url string,\n       html string,\n       source_tag string,\n       lang string\n   )\n   partitioned BY (ymd string)\n   stored AS parquet  \n   location 'oss://data-dlc/minimax-dialogue/data/chatml/data_type=html_data/';\n   ```\n3. \u81ea\u5b9a\u4e49\u89e3\u6790\u5668\n```sql\nCREATE EXTERNAL TABLE ods_crawler_sites_warc_data_extract_result_external_hi (\n    warc_host string,\n    meta_info string,\n    final_url string,\n    status_code string,\n    data_dt string,\n    biz_code string,\n    target_url string,\n    warc_date string,\n    content_type string,\n    content_length string,\n    warc_file_name string,\n    content string,\n    import_msg string\n)\nPARTITIONED BY (\n    host string,\n    status string,\n    ymd string,\n    hour string\n)\nstored BY 'com.crawler.udf.sites_warc.WarcStorageHandler' \nwith serdeproperties (\n    'max_file_size' = '157286400'\n) \nLOCATION 'oss://crawler-data-storage/Crawlerlee/'\nUSING 'crawler_udf-1.0-SNAPSHOT.jar'\n```\n\u53ef\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\n\n### 2. \u4f7f\u7528\n1. \u63d2\u5165\u6570\u636e\n```sql\nSET odps.sql.unstructured.oss.commit.mode = true; -- \u9632\u6b62\u751f\u6210.odps\u6587\u4ef6\u5939\nINSERT OVERWRITE TABLE dwd_crawler_html_out_di PARTITION(ymd='${P_DATE}')\nSELECT \n    a.source_url,\n    html,\n    biz_code,\n    parse_lang\nFROM \n    dwd_crawler_content_filtered_detail_byscore_di a\nWHERE \n    a.ymd = '${P_DATE}'\n    AND a.score_level != 'low'\n    AND COALESCE(html, '') != ''\n```\n2. \u8bfb\u53d6\u6570\u636e\n```\n-- \u626b\u63cf\u6240\u6709\u8def\u5f84\nmsck TABLE ods_crawler_sites_warc_data_extract_result_external_hi ADD partitions;\n-- \u626b\u63cf\u6307\u5b9a\u8def\u5f84\nALTER TABLE ods_crawler_sites_warc_data_extract_result_external_hi ADD IF NOT EXISTS \nPARTITION (host='demo.com',status='error',ymd='20250624', hour='09') \nPARTITION (host='demo.com',status='success',ymd='20250624', hour='09')\n;\n-- \u6307\u5b9alocation\nALTER TABLE log_table_external ADD PARTITION (year = '2016', month = '06', day = '01')\nlocation 'oss://oss-cn-hangzhou-internal.aliyuncs.com/bucket\u540d\u79f0/oss-odps-test/log_data_customized/2016/06/01/';\n-- \u6307\u5b9a\u8def\u5f84\u6620\u5c04\nMSCK REPAIR TABLE  ods_crawler_sites_warc_data_extract_result_external_hi ADD PARTITIONS\nWITH PROPERTIES ('odps.msck.partition.column.mapping'='host:host,status:status,ymd:ymd');\n```\u3002", "top": 0, "createdAt": 1750837119, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}, "P7": {"htmlDir": "docs/post/a-li-yun-ge-ren-shi-yong-de-yi-xie-zi-shi.html", "labels": ["\u6570\u4ed3"], "postTitle": "\u963f\u91cc\u4e91\u4e2a\u4eba\u4f7f\u7528\u7684\u4e00\u4e9b\u59ff\u52bf", "postUrl": "post/a-li-yun-ge-ren-shi-yong-de-yi-xie-zi-shi.html", "postSourceUrl": "https://github.com/enderTree/blog/issues/7", "commentNum": 0, "wordCount": 8249, "description": "# \u963f\u91cc\u4e91\u4e2a\u4eba\u4f7f\u7528\u7684\u4e00\u4e9b\u59ff\u52bf\n\n## \u4e00\u3001\u767b\u5f55\n\n[\u767b\u5f55 dataworks](https://dataworks.console.aliyun.com/workspace/list)\uff0c\u9009\u62e9\u5bf9\u5e94\u5de5\u4f5c\u7a7a\u95f4\u8fdb\u5165\uff0c\u663e\u793a\u65e0\u7a7a\u95f4\u627e\u7ba1\u7406\u5458\u5f00\u901a\n\n<img width='1693' alt='Image' src='https://github.com/user-attachments/assets/b2e470eb-06e2-4c2c-8d12-da6232adc7b2' />\n\n<img width='1238' alt='Image' src='https://github.com/user-attachments/assets/2408c27a-fcf3-4631-a68a-2f3005c49936' />\n\n## \u4e8c\u3001\u4e34\u65f6 Sql \u8fd0\u884c\n\n\u4e34\u65f6\u67e5\u8be2\u4e0b\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5728\u4e0b\u9762\u65b0\u5efa odps sql \u8282\u70b9\u5373\u53ef\n\n## \u4e09\u3001\u5468\u671f\u4efb\u52a1\n\n### sql \u4efb\u52a1\n\n\u4e1a\u52a1\u6d41\u7a0b MaxCompute \u6570\u636e\u5f00\u53d1\u76ee\u5f55\u4e0b\u65b0\u5efa ODPS Sql \u8282\u70b9\n\n### PySpark \u7b80\u5355\u6a21\u5f0f\n\n[\u5b98\u65b9\u6587\u6863](https://help.aliyun.com/zh/maxcompute/user-guide/develop-a-spark-on-maxcompute-application-by-using-pyspark?spm=a2c4g.11186623.0.i2)\n\n1. \u8d44\u6e90\u4e2d\u65b0\u5efa python \u811a\u672c\n   \n<img width='443' alt='Image' src='https://github.com/user-attachments/assets/9e325886-5153-4c75-b19b-23fa6476f1b6' />\n\n ```python\nfrom pyspark.sql import SparkSession\nif __name__ == '__main__':\nspark = SparkSession.builder.appName('spark sql').getOrCreate()\nspark.sql('SELECT 1').show()\n```\n2. \u6570\u636e\u5f00\u53d1\u6587\u4ef6\u5939\u65b0\u5efaodps spark\u8282\u70b9\n\n<img width='735' alt='Image' src='https://github.com/user-attachments/assets/e4a30db5-a9b3-4110-bd83-85c764450f39' />\n\n\u53d1\u5e03\u4e0a\u7ebf\u7686\u53ef\uff0csparkui\u4f1a\u5728\u65e5\u5fd7\u4e2d\u6253\u5370\n\n### PySpark\u517c\u5bb9\u6a21\u5f0f\n\n\u963f\u91cc\u4e91\u7684PySpark\u662f\u57fa\u4e8ePython 3.7 + Spark2\u7684\uff0c\u800c\u4e14\u770b\u4e0a\u53bb\u5df2\u7ecf\u758f\u4e8e\u7ef4\u62a4\u4e86\u3002", "top": 0, "createdAt": 1750849572, "style": "", "script": "<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script>", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-06-25", "dateLabelColor": "#0969da"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "java": "#819a26", "python": "#379210", "sql": "#a3bf9d", "udf": "#9b26f8", "\u6570\u4ed3": "#3bc693"}, "displayTitle": "ender'Blog", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://enderTree.github.io/blog", "prevUrl": "disabled", "nextUrl": "disabled"}